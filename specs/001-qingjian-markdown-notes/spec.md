# Feature Specification: 青简（qingjian）Markdown 笔记应用（macOS/iOS）

**Feature Branch**: `001-qingjian-markdown-notes`  
**Created**: 2025-12-24  
**Status**: Draft  
**Input**: User description: "我想构建一款基于 markdown 的笔记软件, 中文名叫青简，英文qingjian。它有现代化的UI。它有 mac os 和 ios 版本。它是原生应用，保证性能。它是一款单机软件，支持通过 iCloud 同步文件。基于文本文件，方便使用 git，cloud storage 等进行同步。macos 上支持 vim mode 编辑笔记内容, ios端不支持 vim mode, ios端也可以不支持编辑 只支持查看, 这一点综合平衡实现复杂度和用户体验进行决策。macos 端支持边编辑边预览。支持 view 模式，将 markdown 渲染为优雅的格式。支持方便的插入本地图片和在线图片， 插入的图片也保存在后边提到的Repo里，便于同步和导出。支持 dark mode。支持多仓库（Repo）, 可以类比 git/github repository 的概念，它是一组笔记、笔记目录的存储，物理上它对应一个文件夹，这样可以将技术笔记仓库和生活笔记仓库，或其他笔记仓库分开。每个仓库支持无限层级目录， 可以通过设计保存元数据等手段使目录和文件支持拖动排序, 这点是区别于普通文件系统的。可以同时打开多个Repo。它是一款付费软件，一次性付费，不是订阅制，支持7天免费试用，试用和付费使用app store 提供的机制和能力。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 打开仓库并优雅查看笔记（View 模式）(Priority: P1)

作为用户，我希望把一组 Markdown 笔记当作“仓库（Repo）”打开并浏览目录树，点击任意笔记即可进入查看模式，渲染出优雅、可阅读的格式；这样我可以把内容放在纯文本文件里，用 git/云盘自由同步与备份，同时在应用里获得更好的阅读体验。

**Why this priority**: 这是产品的核心价值（基于文本文件的 Markdown 笔记 + 优雅阅读），不依赖编辑器或同步就能交付可用的最小版本。

**Independent Test**: 在干净环境创建/导入一个本地文件夹作为 Repo，浏览目录、打开笔记、切换查看模式、验证渲染与资源引用可用。

**Acceptance Scenarios**:

1. **Given** 用户首次启动应用且尚未添加任何 Repo，**When** 用户选择一个本地文件夹作为 Repo 并打开，**Then** 应用展示该 Repo 的目录树与笔记列表，且记住该 Repo 以便下次快速打开
2. **Given** Repo 中存在 `README.md` 等 Markdown 文件，**When** 用户点击某笔记进入 View 模式，**Then** 应用以排版良好的方式渲染标题、段落、列表、代码块、引用、链接等常见 Markdown 结构
3. **Given** 笔记中引用了图片（本地或在线），**When** 用户在 View 模式打开该笔记，**Then** 图片在可用网络/可访问文件路径下可正常显示；不可访问时给出清晰的占位与错误提示

---

### User Story 2 - macOS 高效编辑：Vim 模式 + 边写边预览 + 快速插图 (Priority: P2)

作为 macOS 用户，我希望在编辑笔记时支持 Vim 模式（用于高效文本编辑），并在同一界面中边编辑边预览渲染效果；同时能方便地插入本地图片或在线图片，且本地图片会被放入当前 Repo 中，便于同步、导出与迁移。

**Why this priority**: 这是“性能与生产力”的关键差异点（原生体验 + Vim + 分屏预览 + 图片资产统一管理），显著提升写作效率。

**Independent Test**: 仅在 macOS 实现编辑器与预览，不依赖 iCloud；用一个包含图片资源的 Repo 完成“编辑→插图→预览更新→保存→重新打开验证”。

**Acceptance Scenarios**:

1. **Given** 用户在 macOS 打开某笔记进入编辑界面，**When** 用户切换 Vim 模式并进行常见操作（移动、选择、删除、撤销/重做），**Then** 编辑行为符合 Vim 直觉且不会出现明显的输入延迟
2. **Given** 用户在编辑界面同时打开预览，**When** 用户修改 Markdown 内容，**Then** 预览在短时间内反映最新内容，并保持滚动/定位体验可用（例如不会频繁跳动导致无法阅读）
3. **Given** 用户希望插入本地图片，**When** 用户通过拖拽/选择文件插入图片，**Then** 应用将图片复制或导入到当前 Repo 的资产位置，并在笔记中插入可用的引用，使其在 View/预览中可正常展示

---

### User Story 3 - 多仓库工作流 + iCloud 同步 + 可控排序 (Priority: P3)

作为用户，我希望能同时打开多个 Repo（例如“技术笔记”“生活笔记”分开管理），每个 Repo 支持无限层级目录；同时我希望可通过拖拽对目录和文件进行自定义排序（不完全依赖文件系统默认排序），并可选择开启 iCloud 让同一账号下的设备同步这些 Repo 内容。

**Why this priority**: 这是规模化使用的关键（多 Repo、可控排序、跨设备一致），能够支撑长期沉淀与多场景切换。

**Independent Test**: 在同一设备上创建两个 Repo，拖拽调整排序并关闭/重启应用验证持久化；开启 iCloud 后在两台设备间验证同步与冲突提示（不要求自动合并）。

**Acceptance Scenarios**:

1. **Given** 用户已添加至少两个 Repo，**When** 用户在应用内切换或并行打开 Repo，**Then** 每个 Repo 的目录树与最近打开的笔记状态互不干扰且可快速切换
2. **Given** 某 Repo 的同一目录下有多个子目录/文件，**When** 用户拖拽调整顺序，**Then** 应用在该 Repo 范围内持久化此顺序，并在下次打开时保持一致
3. **Given** 用户为某 Repo 开启 iCloud 同步，**When** 在设备 A 修改笔记并保存、设备 B 处于在线状态，**Then** 设备 B 在合理时间内看到更新（或看到冲突/需要处理的提示）

---

### Edge Cases

- Repo 指向的文件夹被移动/重命名/权限变化后，应用如何提示并恢复
- 同一 Repo 在多处同时被编辑导致内容冲突时如何处理与提示
- 极大 Markdown 文件（例如数万行）打开、滚动、预览时的体验退化
- 图片资源缺失、损坏、或在线图片不可访问时的降级表现
- 用户在拖拽排序后又在文件系统层面新增/删除/重命名文件时，排序与展示如何保持直觉一致
- 暗黑模式切换时，View/预览/编辑器的可读性与对比度

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 支持创建/添加/移除 Repo；每个 Repo 物理上对应一个用户可见的文件夹
- **FR-002**: 系统 MUST 支持同时打开与管理多个 Repo，并能在不同 Repo 间快速切换
- **FR-003**: 系统 MUST 在 Repo 内展示无限层级的目录与笔记文件（以目录树方式浏览）
- **FR-004**: 系统 MUST 支持在 View 模式将 Markdown 渲染为优雅、可阅读的格式（覆盖常见 Markdown 语法要素）
- **FR-005**: 系统 MUST 支持深色模式（Dark Mode），且在 View/预览/编辑界面均保持可读性
- **FR-006**: 系统 MUST 将笔记以文本文件形式存储，且用户可在应用外使用 git/云盘等工具管理这些文件
- **FR-007**: macOS 客户端 MUST 支持编辑 Markdown 笔记并保存到对应的文本文件
- **FR-008**: macOS 客户端 MUST 支持 Vim 模式编辑（至少覆盖高频编辑操作：移动、选择、删除、撤销/重做、查找）
- **FR-009**: macOS 客户端 MUST 支持“边编辑边预览”（例如同屏分栏或并排区域），并在用户编辑后及时更新预览内容
- **FR-010**: 系统 MUST 支持插入本地图片到笔记中，并将图片资产保存在当前 Repo 内（便于同步/导出）
- **FR-011**: 系统 MUST 支持插入在线图片链接到笔记中，并在 View/预览中展示；当链接不可访问时提供清晰提示
- **FR-012**: iOS 客户端 MUST 仅支持对 Repo 中笔记的查看（View 模式），并提供快捷操作（至少包含：复制文本、分享、导出/系统共享）
- **FR-013**: 系统 MUST 支持打开同一 Repo 下的不同笔记快速切换，且切换过程对用户而言响应迅速
- **FR-014**: 系统 MUST 支持在 Repo 内创建/重命名/移动/删除目录与笔记（在应用内操作应反映到文件系统可见的结构）
- **FR-015**: 系统 MUST 支持目录与文件的拖拽排序，并在 Repo 范围内持久化该顺序（不依赖文件系统默认排序）
- **FR-016**: 当用户启用 iCloud 同步后，系统 MUST 在多设备间同步 Repo 的文件变化；当发生冲突时，系统 MUST 以可操作的方式提示用户处理，并支持用户选择保留版本或进行合并后保存
- **FR-017**: 系统 MUST 支持离线使用；当网络不可用时不影响本地查看/编辑与保存
- **FR-018**: 系统 MUST 支持一次性付费购买与 7 天免费试用；试用结束但未购买时，系统 MUST 进入锁定状态并引导购买，同时 MUST 允许用户导出/迁移其 Repo 数据
- **FR-019**: 系统 MUST 提供导出/迁移友好的数据组织方式（用户可直接复制 Repo 文件夹即可备份/迁移到其他存储）
- **FR-020**: 系统 MUST 避免引入不必要的复杂度（尽量少的配置项、菜单与快捷键），保证核心工作流清晰

### Key Entities *(include if feature involves data)*

- **Repository (Repo)**: 一组笔记与目录的集合；对应用户选择的文件夹；包含该 Repo 的显示名称、打开状态、排序元数据等
- **Folder**: Repo 内的目录节点；包含子节点列表与自定义排序信息
- **Note**: 一个 Markdown 文本文件；包含路径、标题（可从内容推断）、最近编辑时间、打开状态等
- **Asset**: 与笔记相关的资源（例如图片）；包含在 Repo 内的存储位置与引用关系
- **Repo Metadata**: 为支持拖拽排序、多窗口/多 Repo 状态等而保存的元数据（需与文本文件内容解耦）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 新用户在 5 分钟内完成“添加一个 Repo → 打开一篇笔记 → 进入 View 模式阅读”的主流程，且无需查阅外部文档
- **SC-002**: 在包含 1,000 篇笔记的 Repo 中，打开应用后进入可浏览状态的时间不超过 2 秒（在常见设备条件下）
- **SC-003**: 在包含 1,000 篇笔记的 Repo 中，切换笔记进入 View 模式的时间在 95% 情况下不超过 0.3 秒
- **SC-004**: 在 macOS 边编辑边预览场景下，用户修改内容后预览在 95% 情况下于 0.2 秒内可见更新（不要求逐字实时，但需对用户“感觉即时”）
- **SC-005**: 用户启用 iCloud 同步后，设备 A 保存的笔记变更在两设备都在线时，设备 B 在 60 秒内可见更新或收到可操作的冲突提示

## Assumptions & Dependencies

### Assumptions

- 用户选择的 Repo 文件夹对应用有长期可访问权限（未被撤销权限、未被系统限制访问）
- 用户接受“基于文本文件”的工作方式：应用对文件的创建/重命名/移动/删除会直接反映到文件系统
- 笔记主要以 Markdown 文本为主；除图片等资产外不以管理二进制内容为核心诉求

### Dependencies

- iCloud 同步依赖用户已登录 Apple ID 且设备具备网络连接能力
- 7 天试用与一次性购买依赖 App Store 提供的购买/试用能力与可用性

## Out of Scope

- 不提供内置 git 提交/推送/拉取等版本管理功能（但 Repo 基于文件夹与文本文件，天然兼容 git/云盘工具）
- 不提供团队协作、实时协同编辑与权限管理
- 不提供非 Apple 平台版本（如 Windows/Android/Web）
